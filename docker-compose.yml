version: '3.8'
services:
  langchain:
    build: ./langchain-container
    ports:
      - "50051:50051" # gRPC-Port (1)
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    # depends_on:
    #   - langchain-redis
    networks:
      - network
  knowledge_base:
      build: ./knowledge_base
      ports:
        - "50052:50052" # gRPC-Port (2)
      environment:
        - OPENAI_API_KEY=${OPENAI_API_KEY}
      networks:
        - network
  fastapi:
      build: ./fastapi-container
      ports:
        - "80:80" # HTTP-Port
      networks:
        - network
      depends_on:
        - langchain


  # langchain-redis: 
  #     image: redis:alpine
  #     ports:
  #       - "6379:6379" # Redis default port
  #     volumes:
  #       - "./healthchecks:/healthchecks"
  #     healthcheck:
  #       test: /healthchecks/redis.sh
  #       interval: "5s"
  #     networks:
  #       - network





  streamlit:
        build: ./streamlit
        ports:
          - "8501:8501"
        networks:
          - network
        environment:
          - OPENAI_API_KEY=${OPENAI_API_KEY}
        depends_on:
          - fastapi
          - knowledge_base
          - langchain

networks:
  network:
